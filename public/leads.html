<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leads</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #09090f;
      color: #f0f0f8;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
      padding: 2.5rem 1.5rem 5rem;
      max-width: 680px;
      margin: 0 auto;
      -webkit-font-smoothing: antialiased;
    }

    h1 {
      font-size: 1rem;
      font-weight: 700;
      color: #6b6b88;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.4rem;
    }

    .meta-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
    }

    .count {
      color: #34d399;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .refresh-note {
      color: #2a2a3d;
      font-size: 0.72rem;
    }

    .empty {
      color: #6b6b88;
      font-size: 0.9rem;
      padding: 3rem 0;
      text-align: center;
    }

    .lead {
      border-bottom: 1px solid #1a1a28;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 1rem;
      align-items: start;
      padding: 0.85rem 0;
    }

    .lead:first-child { border-top: 1px solid #1a1a28; }

    .email {
      color: #c4b5fd;
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .stats {
      color: #6b6b88;
      font-size: 0.78rem;
      line-height: 1.6;
    }

    .value {
      color: #34d399;
      font-weight: 600;
    }

    .date {
      color: #2a2a3d;
      font-size: 0.75rem;
      text-align: right;
      white-space: nowrap;
    }

    .clear-btn {
      background: none;
      border: 1px solid #2a2a3d;
      border-radius: 6px;
      color: #6b6b88;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.75rem;
      padding: 0.3rem 0.7rem;
      margin-top: 2.5rem;
      transition: color 0.15s, border-color 0.15s;
    }

    .clear-btn:hover { color: #f87171; border-color: rgba(248,113,113,0.4); }
  </style>
</head>
<body>

  <h1>Creator Leads</h1>

  <div class="meta-bar">
    <span class="count" id="count"></span>
    <span class="refresh-note">auto-refreshes every 5s</span>
  </div>

  <div id="list"></div>

  <button class="clear-btn" onclick="clearLeads()">Clear all leads</button>

  <script>
    function render() {
      const data = JSON.parse(localStorage.getItem('creator_leads') || '[]')
      const list = document.getElementById('list')
      const countEl = document.getElementById('count')

      if (data.length === 0) {
        countEl.textContent = '0 leads'
        list.innerHTML = '<p class="empty">No leads yet. Submit an email on the calculator to see it here.</p>'
        return
      }

      const sorted = [...data].sort((a, b) => b.ts - a.ts)
      countEl.textContent = sorted.length + ' lead' + (sorted.length !== 1 ? 's' : '')

      list.innerHTML = sorted.map(lead => {
        const date = new Date(lead.ts)
        const dateStr = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })
        const timeStr = date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' })
        const views = lead.views ? Number(lead.views).toLocaleString() : '—'
        const val   = lead.calculatedValue || '—'

        return `
          <div class="lead">
            <div>
              <div class="email">${lead.email}</div>
              <div class="stats">
                Views: ${views} &nbsp;·&nbsp;
                Estimated value: <span class="value">${val}</span>
              </div>
            </div>
            <div class="date">${dateStr}<br/>${timeStr}</div>
          </div>
        `
      }).join('')
    }

    function clearLeads() {
      if (confirm('Delete all leads? This cannot be undone.')) {
        localStorage.removeItem('creator_leads')
        render()
      }
    }

    render()
    setInterval(render, 5000)
  </script>

</body>
</html>
